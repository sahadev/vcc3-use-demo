{"version":3,"file":"dropdown-menu.vue_vue_type_script_lang.mjs","sources":["../../../../../../packages/components/dropdown/src/dropdown-menu.vue"],"sourcesContent":["<template>\n  <ul\n    :ref=\"dropdownListWrapperRef\"\n    :class=\"['el-dropdown-menu', size && `el-dropdown-menu--${size}`]\"\n    :style=\"rovingFocusGroupRootStyle\"\n    :tabindex=\"-1\"\n    role=\"menu\"\n    @blur=\"onBlur\"\n    @focus=\"onFocus\"\n    @keydown=\"handleKeydown\"\n    @mousedown=\"onMousedown\"\n  >\n    <slot></slot>\n  </ul>\n</template>\n<script lang=\"ts\">\nimport { defineComponent, inject, unref } from 'vue'\nimport { ClickOutside } from '@element-plus/directives'\nimport { EVENT_CODE } from '@element-plus/utils/aria'\nimport { FOCUS_TRAP_INJECTION_KEY } from '@element-plus/components/focus-trap'\nimport {\n  ROVING_FOCUS_COLLECTION_INJECTION_KEY,\n  ROVING_FOCUS_GROUP_INJECTION_KEY,\n  focusFirst,\n} from '@element-plus/components/roving-focus-group'\nimport { composeRefs, composeEventHandlers } from '@element-plus/utils/dom'\nimport { DROPDOWN_INJECTION_KEY } from './tokens'\nimport {\n  DROPDOWN_COLLECTION_INJECTION_KEY,\n  dropdownMenuProps,\n  FIRST_LAST_KEYS,\n  LAST_KEYS,\n} from './dropdown'\nimport { useDropdown } from './useDropdown'\n\nexport default defineComponent({\n  name: 'ElDropdownMenu',\n  directives: {\n    ClickOutside,\n  },\n  inheritAttrs: false,\n  props: dropdownMenuProps,\n  setup(props) {\n    const { _elDropdownSize } = useDropdown()\n    const size = _elDropdownSize.value\n\n    const { focusTrapRef, onKeydown } = inject(\n      FOCUS_TRAP_INJECTION_KEY,\n      undefined\n    )!\n\n    const { contentRef } = inject(DROPDOWN_INJECTION_KEY, undefined)!\n\n    const { collectionRef: dropdownCollectionRef, getItems } = inject(\n      DROPDOWN_COLLECTION_INJECTION_KEY,\n      undefined\n    )!\n\n    const {\n      rovingFocusGroupRef,\n      rovingFocusGroupRootStyle,\n      tabIndex,\n      onBlur,\n      onFocus,\n      onMousedown,\n    } = inject(ROVING_FOCUS_GROUP_INJECTION_KEY, undefined)!\n\n    const { collectionRef: rovingFocusGroupCollectionRef } = inject(\n      ROVING_FOCUS_COLLECTION_INJECTION_KEY,\n      undefined\n    )!\n\n    const dropdownListWrapperRef = composeRefs(\n      contentRef,\n      dropdownCollectionRef,\n      focusTrapRef,\n      rovingFocusGroupRef,\n      rovingFocusGroupCollectionRef\n    )\n\n    const composedKeydown = composeEventHandlers(\n      (e: KeyboardEvent) => {\n        props.onKeydown?.(e)\n      },\n      (e) => {\n        const { currentTarget, code, target } = e\n        const isKeydownContained = (currentTarget as Node).contains(\n          target as Node\n        )\n\n        if (isKeydownContained) {\n          // TODO: implement typeahead search\n        }\n\n        if (EVENT_CODE.tab === code) {\n          e.stopImmediatePropagation()\n        }\n\n        e.preventDefault()\n\n        if (target !== unref(contentRef)) return\n        if (!FIRST_LAST_KEYS.includes(code)) return\n        const items = getItems<{ disabled: boolean }>().filter(\n          (item) => !item.disabled\n        )\n        const targets = items.map((item) => item.ref!)\n        if (LAST_KEYS.includes(code)) {\n          targets.reverse()\n        }\n        focusFirst(targets)\n      }\n    )\n\n    const handleKeydown = (e: KeyboardEvent) => {\n      composedKeydown(e)\n      onKeydown(e)\n    }\n\n    return {\n      size,\n      rovingFocusGroupRootStyle,\n      tabIndex,\n      dropdownListWrapperRef,\n      handleKeydown,\n      onBlur,\n      onFocus,\n      onMousedown,\n    }\n  },\n})\n</script>\n"],"names":[],"mappings":";;;;;;;;;;;;;;;AAiCA,aAAe,eAAe,CAAC;;AAE/B,EAAE,UAAU;IACR,YAAY;GACb;cACW,EAAE;EACd;EACA,KAAK,CAAC,KAAK;IACT,MAAM,EAAE;IACR,MAAM;IACN,MAAM,EAAE,YAAY,EAAE,SAAS,EAAE,GAAG;IACpC,MAAM,EAAE,UAAU,EAAE,GAAG,MAAM,CAAC;;IAE9B,MAAM;MACJ,mBAAmB;MACnB;;;MAGA,OAAO;;KAER,GAAG,MAAM,CAAC,gCAAgC,OAAO,CAAC,CAAC,CAAC;UAC/C,EAAE,aAAa,EAAE;UACjB;IACN;;MAEE,CAAC;OACA,CAAC,CAAC,KAAK;MACR,MAAM,EAAE,aAAa,EAAE;MACvB,MAAM;MACN,IAAI;OACH;MACD,IAAI;QACF,CAAC,CAAC,wBAAwB,EAAE,CAAC;;MAE/B,CAAC,CAAC,cAAc,EAAE,CAAC;MACnB,IAAI,MAAM,KAAK,KAAK,CAAC,UAAU,CAAC;QAC9B;;;MAGF,MAAM,KAAK,GAAG,QAAQ,EAAE,CAAC,MAAM,CAAC,CAAC,IAAI;MACrC,MAAM;MACN,IAAI,SAAS,CAAC;QACZ,OAAO,CAAC;OACT;MACD,UAAU,CAAC,OAAO,CAAC,CAAC;;;MAGpB,eAAe,CAAC,CAAC,CAAC;MAClB,SAAS,CAAC,CAAC,CAAC,CAAC;;;MAGb,IAAI;+BACqB;cACjB;;;;aAID;iBACI;;;;;;;"}