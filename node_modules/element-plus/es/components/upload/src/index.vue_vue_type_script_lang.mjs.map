{"version":3,"file":"index.vue_vue_type_script_lang.mjs","sources":["../../../../../../packages/components/upload/src/index.vue"],"sourcesContent":["<script lang=\"ts\">\nimport {\n  computed,\n  defineComponent,\n  h,\n  getCurrentInstance,\n  inject,\n  ref,\n  provide,\n  onBeforeUnmount,\n} from 'vue'\nimport { NOOP } from '@vue/shared'\nimport { elFormKey } from '@element-plus/tokens'\n\nimport ajax from './ajax'\nimport UploadList from './upload-list.vue'\nimport Upload from './upload.vue'\nimport useHandlers from './useHandlers'\n\nimport type { PropType } from 'vue'\nimport type { ElFormContext } from '@element-plus/tokens'\nimport type { Nullable } from '@element-plus/utils/types'\nimport type {\n  ListType,\n  UploadFile,\n  FileHandler,\n  FileResultHandler,\n} from './upload.type'\n\ntype PFileHandler<T> = PropType<FileHandler<T>>\ntype PFileResultHandler<T = any> = PropType<FileResultHandler<T>>\n\nexport default defineComponent({\n  name: 'ElUpload',\n  components: {\n    Upload,\n    UploadList,\n  },\n  props: {\n    action: {\n      type: String,\n      required: true,\n    },\n    headers: {\n      type: Object as PropType<Headers>,\n      default: () => ({}),\n    },\n    method: {\n      type: String,\n      default: 'post',\n    },\n    data: {\n      type: Object,\n      default: () => ({}),\n    },\n    multiple: {\n      type: Boolean,\n      default: false,\n    },\n    name: {\n      type: String,\n      default: 'file',\n    },\n    drag: {\n      type: Boolean,\n      default: false,\n    },\n    withCredentials: Boolean,\n    showFileList: {\n      type: Boolean,\n      default: true,\n    },\n    accept: {\n      type: String,\n      default: '',\n    },\n    type: {\n      type: String,\n      default: 'select',\n    },\n    beforeUpload: {\n      type: Function as PFileHandler<void>,\n      default: NOOP,\n    },\n    beforeRemove: {\n      type: Function as PFileHandler<boolean>,\n      default: NOOP,\n    },\n    onRemove: {\n      type: Function as PFileHandler<void>,\n      default: NOOP,\n    },\n    onChange: {\n      type: Function as PFileHandler<void>,\n      default: NOOP,\n    },\n    onPreview: {\n      type: Function as PropType<() => void>,\n      default: NOOP,\n    },\n    onSuccess: {\n      type: Function as PFileResultHandler,\n      default: NOOP,\n    },\n    onProgress: {\n      type: Function as PFileResultHandler<ProgressEvent>,\n      default: NOOP,\n    },\n    onError: {\n      type: Function as PFileResultHandler<Error>,\n      default: NOOP,\n    },\n    fileList: {\n      type: Array as PropType<UploadFile[]>,\n      default: () => {\n        return [] as UploadFile[]\n      },\n    },\n    autoUpload: {\n      type: Boolean,\n      default: true,\n    },\n    listType: {\n      type: String as PropType<ListType>,\n      default: 'text' as ListType, // text,picture,picture-card\n    },\n    httpRequest: {\n      type: Function,\n      default: ajax,\n    },\n    disabled: Boolean,\n    limit: {\n      type: Number as PropType<Nullable<number>>,\n      default: null,\n    },\n    onExceed: {\n      type: Function,\n      default: () => NOOP,\n    },\n  },\n  setup(props) {\n    const elForm = inject(elFormKey, {} as ElFormContext)\n\n    const uploadDisabled = computed(() => {\n      return props.disabled || elForm.disabled\n    })\n\n    const {\n      abort,\n      clearFiles,\n      handleError,\n      handleProgress,\n      handleStart,\n      handleSuccess,\n      handleRemove,\n      submit,\n      uploadRef,\n      uploadFiles,\n    } = useHandlers(props)\n\n    provide('uploader', getCurrentInstance())\n\n    onBeforeUnmount(() => {\n      uploadFiles.value.forEach((file) => {\n        if (file.url && file.url.indexOf('blob:') === 0) {\n          URL.revokeObjectURL(file.url)\n        }\n      })\n    })\n\n    return {\n      abort,\n      dragOver: ref(false),\n      draging: ref(false),\n      handleError,\n      handleProgress,\n      handleRemove,\n      handleStart,\n      handleSuccess,\n      uploadDisabled,\n      uploadFiles,\n      uploadRef,\n      submit,\n      clearFiles,\n    }\n  },\n  render() {\n    let uploadList\n    if (this.showFileList) {\n      uploadList = h(\n        UploadList,\n        {\n          disabled: this.uploadDisabled,\n          listType: this.listType,\n          files: this.uploadFiles,\n          onRemove: this.handleRemove,\n          handlePreview: this.onPreview,\n        },\n        this.$slots.file\n          ? {\n              default: (props: { file: UploadFile }) => {\n                return this.$slots.file({\n                  file: props.file,\n                })\n              },\n            }\n          : null\n      )\n    } else {\n      uploadList = null\n    }\n\n    const uploadData = {\n      type: this.type,\n      drag: this.drag,\n      action: this.action,\n      multiple: this.multiple,\n      'before-upload': this.beforeUpload,\n      'with-credentials': this.withCredentials,\n      headers: this.headers,\n      method: this.method,\n      name: this.name,\n      data: this.data,\n      accept: this.accept,\n      fileList: this.uploadFiles,\n      autoUpload: this.autoUpload,\n      listType: this.listType,\n      disabled: this.uploadDisabled,\n      limit: this.limit,\n      'on-exceed': this.onExceed,\n      'on-start': this.handleStart,\n      'on-progress': this.handleProgress,\n      'on-success': this.handleSuccess,\n      'on-error': this.handleError,\n      'on-preview': this.onPreview,\n      'on-remove': this.handleRemove,\n      'http-request': this.httpRequest,\n      ref: 'uploadRef',\n    }\n    const trigger = this.$slots.trigger || this.$slots.default\n    const uploadComponent = h(Upload, uploadData, {\n      default: () => trigger?.(),\n    })\n    return h('div', [\n      this.listType === 'picture-card' ? uploadList : null,\n      this.$slots.trigger\n        ? [uploadComponent, this.$slots.default()]\n        : uploadComponent,\n      this.$slots.tip?.(),\n      this.listType !== 'picture-card' ? uploadList : null,\n    ])\n  },\n})\n</script>\n"],"names":["Upload","UploadList"],"mappings":"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"}