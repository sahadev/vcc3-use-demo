{"version":3,"file":"panel-month-range.vue_vue_type_script_lang.js","sources":["../../../../../../../packages/components/date-picker/src/date-picker-com/panel-month-range.vue"],"sourcesContent":["<template>\n  <div\n    class=\"el-picker-panel el-date-range-picker\"\n    :class=\"[\n      {\n        'has-sidebar': $slots.sidebar || hasShortcuts,\n      },\n    ]\"\n  >\n    <div class=\"el-picker-panel__body-wrapper\">\n      <slot name=\"sidebar\" class=\"el-picker-panel__sidebar\"></slot>\n      <div v-if=\"hasShortcuts\" class=\"el-picker-panel__sidebar\">\n        <button\n          v-for=\"(shortcut, key) in shortcuts\"\n          :key=\"key\"\n          type=\"button\"\n          class=\"el-picker-panel__shortcut\"\n          @click=\"handleShortcutClick(shortcut)\"\n        >\n          {{ shortcut.text }}\n        </button>\n      </div>\n      <div class=\"el-picker-panel__body\">\n        <div\n          class=\"el-picker-panel__content el-date-range-picker__content is-left\"\n        >\n          <div class=\"el-date-range-picker__header\">\n            <button\n              type=\"button\"\n              class=\"el-picker-panel__icon-btn d-arrow-left\"\n              @click=\"leftPrevYear\"\n            >\n              <el-icon><d-arrow-left /></el-icon>\n            </button>\n            <button\n              v-if=\"unlinkPanels\"\n              type=\"button\"\n              :disabled=\"!enableYearArrow\"\n              :class=\"{ 'is-disabled': !enableYearArrow }\"\n              class=\"el-picker-panel__icon-btn d-arrow-right\"\n              @click=\"leftNextYear\"\n            >\n              <el-icon><d-arrow-right /></el-icon>\n            </button>\n            <div>{{ leftLabel }}</div>\n          </div>\n          <month-table\n            selection-mode=\"range\"\n            :date=\"leftDate\"\n            :min-date=\"minDate\"\n            :max-date=\"maxDate\"\n            :range-state=\"rangeState\"\n            :disabled-date=\"disabledDate\"\n            @changerange=\"handleChangeRange\"\n            @pick=\"handleRangePick\"\n            @select=\"onSelect\"\n          />\n        </div>\n        <div\n          class=\"el-picker-panel__content el-date-range-picker__content is-right\"\n        >\n          <div class=\"el-date-range-picker__header\">\n            <button\n              v-if=\"unlinkPanels\"\n              type=\"button\"\n              :disabled=\"!enableYearArrow\"\n              :class=\"{ 'is-disabled': !enableYearArrow }\"\n              class=\"el-picker-panel__icon-btn d-arrow-left\"\n              @click=\"rightPrevYear\"\n            >\n              <el-icon><d-arrow-left /></el-icon>\n            </button>\n            <button\n              type=\"button\"\n              class=\"el-picker-panel__icon-btn d-arrow-right\"\n              @click=\"rightNextYear\"\n            >\n              <el-icon><d-arrow-right /></el-icon>\n            </button>\n            <div>{{ rightLabel }}</div>\n          </div>\n          <month-table\n            selection-mode=\"range\"\n            :date=\"rightDate\"\n            :min-date=\"minDate\"\n            :max-date=\"maxDate\"\n            :range-state=\"rangeState\"\n            :disabled-date=\"disabledDate\"\n            @changerange=\"handleChangeRange\"\n            @pick=\"handleRangePick\"\n            @select=\"onSelect\"\n          />\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, computed, ref, watch, inject } from 'vue'\nimport dayjs from 'dayjs'\nimport ElIcon from '@element-plus/components/icon'\nimport { useLocale } from '@element-plus/hooks'\nimport { DArrowLeft, DArrowRight } from '@element-plus/icons-vue'\nimport MonthTable from './basic-month-table.vue'\n\nimport type { PropType } from 'vue'\nimport type { Dayjs } from 'dayjs'\n\nexport default defineComponent({\n  components: { MonthTable, ElIcon, DArrowLeft, DArrowRight },\n\n  props: {\n    unlinkPanels: Boolean,\n    parsedValue: {\n      type: Array as PropType<Dayjs[]>,\n    },\n  },\n\n  emits: ['pick', 'set-picker-option'],\n\n  setup(props, ctx) {\n    const { t, lang } = useLocale()\n    const leftDate = ref(dayjs().locale(lang.value))\n    const rightDate = ref(dayjs().locale(lang.value).add(1, 'year'))\n\n    const hasShortcuts = computed(() => !!shortcuts.length)\n\n    const handleShortcutClick = (shortcut) => {\n      const shortcutValues =\n        typeof shortcut.value === 'function' ? shortcut.value() : shortcut.value\n      if (shortcutValues) {\n        ctx.emit('pick', [\n          dayjs(shortcutValues[0]).locale(lang.value),\n          dayjs(shortcutValues[1]).locale(lang.value),\n        ])\n        return\n      }\n      if (shortcut.onClick) {\n        shortcut.onClick(ctx)\n      }\n    }\n\n    const leftPrevYear = () => {\n      leftDate.value = leftDate.value.subtract(1, 'year')\n      if (!props.unlinkPanels) {\n        rightDate.value = rightDate.value.subtract(1, 'year')\n      }\n    }\n\n    const rightNextYear = () => {\n      if (!props.unlinkPanels) {\n        leftDate.value = leftDate.value.add(1, 'year')\n      }\n      rightDate.value = rightDate.value.add(1, 'year')\n    }\n\n    const leftNextYear = () => {\n      leftDate.value = leftDate.value.add(1, 'year')\n    }\n\n    const rightPrevYear = () => {\n      rightDate.value = rightDate.value.subtract(1, 'year')\n    }\n    const leftLabel = computed(() => {\n      return `${leftDate.value.year()} ${t('el.datepicker.year')}`\n    })\n\n    const rightLabel = computed(() => {\n      return `${rightDate.value.year()} ${t('el.datepicker.year')}`\n    })\n\n    const leftYear = computed(() => {\n      return leftDate.value.year()\n    })\n\n    const rightYear = computed(() => {\n      return rightDate.value.year() === leftDate.value.year()\n        ? leftDate.value.year() + 1\n        : rightDate.value.year()\n    })\n\n    const enableYearArrow = computed(() => {\n      return props.unlinkPanels && rightYear.value > leftYear.value + 1\n    })\n\n    const minDate = ref(null)\n    const maxDate = ref(null)\n\n    const rangeState = ref({\n      endDate: null,\n      selecting: false,\n    })\n\n    const handleChangeRange = (val) => {\n      rangeState.value = val\n    }\n\n    const handleRangePick = (val, close = true) => {\n      // const defaultTime = props.defaultTime || []\n      // const minDate_ = modifyWithTimeString(val.minDate, defaultTime[0])\n      // const maxDate_ = modifyWithTimeString(val.maxDate, defaultTime[1])\n      // todo\n      const minDate_ = val.minDate\n      const maxDate_ = val.maxDate\n      if (maxDate.value === maxDate_ && minDate.value === minDate_) {\n        return\n      }\n      maxDate.value = maxDate_\n      minDate.value = minDate_\n\n      if (!close) return\n      handleConfirm()\n    }\n\n    const isValidValue = (value) => {\n      return (\n        Array.isArray(value) &&\n        value &&\n        value[0] &&\n        value[1] &&\n        value[0].valueOf() <= value[1].valueOf()\n      )\n    }\n\n    const handleConfirm = (visible = false) => {\n      if (isValidValue([minDate.value, maxDate.value])) {\n        ctx.emit('pick', [minDate.value, maxDate.value], visible)\n      }\n    }\n\n    const onSelect = (selecting) => {\n      rangeState.value.selecting = selecting\n      if (!selecting) {\n        rangeState.value.endDate = null\n      }\n    }\n\n    const formatToString = (value) => {\n      return value.map((_) => _.format(format))\n    }\n\n    const getDefaultValue = () => {\n      let start: Dayjs\n      if (Array.isArray(defaultValue)) {\n        const left = dayjs(defaultValue[0])\n        let right = dayjs(defaultValue[1])\n        if (!props.unlinkPanels) {\n          right = left.add(1, 'year')\n        }\n        return [left, right]\n      } else if (defaultValue) {\n        start = dayjs(defaultValue)\n      } else {\n        start = dayjs()\n      }\n      start = start.locale(lang.value)\n      return [start, start.add(1, 'year')]\n    }\n\n    // pickerBase.hub.emit('SetPickerOption', ['isValidValue', isValidValue])\n    ctx.emit('set-picker-option', ['formatToString', formatToString])\n    const pickerBase = inject('EP_PICKER_BASE') as any\n    const { shortcuts, disabledDate, format, defaultValue } = pickerBase.props\n\n    watch(\n      () => props.parsedValue,\n      (newVal) => {\n        if (newVal && newVal.length === 2) {\n          minDate.value = newVal[0]\n          maxDate.value = newVal[1]\n          leftDate.value = minDate.value\n          if (props.unlinkPanels && maxDate.value) {\n            const minDateYear = minDate.value.year()\n            const maxDateYear = maxDate.value.year()\n            rightDate.value =\n              minDateYear === maxDateYear\n                ? maxDate.value.add(1, 'year')\n                : maxDate.value\n          } else {\n            rightDate.value = leftDate.value.add(1, 'year')\n          }\n        } else {\n          const defaultArr = getDefaultValue()\n          minDate.value = null\n          maxDate.value = null\n          leftDate.value = defaultArr[0]\n          rightDate.value = defaultArr[1]\n        }\n      },\n      { immediate: true }\n    )\n\n    return {\n      shortcuts,\n      disabledDate,\n      onSelect,\n      handleRangePick,\n      rangeState,\n      handleChangeRange,\n      minDate,\n      maxDate,\n      enableYearArrow,\n      leftLabel,\n      rightLabel,\n      leftNextYear,\n      leftPrevYear,\n      rightNextYear,\n      rightPrevYear,\n      t,\n      leftDate,\n      rightDate,\n      hasShortcuts,\n      handleShortcutClick,\n    }\n  },\n})\n</script>\n"],"names":["defineComponent","ref","dayjs","computed"],"mappings":"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"}