{"version":3,"file":"roving-focus-item.vue_vue_type_script_lang.js","sources":["../../../../../../packages/components/roving-focus-group/src/roving-focus-item.vue"],"sourcesContent":["<template>\n  <el-roving-focus-collection-item\n    :id=\"id\"\n    :focusable=\"focusable\"\n    :active=\"active\"\n  >\n    <slot />\n  </el-roving-focus-collection-item>\n</template>\n\n<script lang=\"ts\">\nimport {\n  computed,\n  defineComponent,\n  inject,\n  ref,\n  unref,\n  nextTick,\n  provide,\n} from 'vue'\nimport { useId } from '@element-plus/hooks'\nimport { composeEventHandlers } from '@element-plus/utils/dom'\nimport { EVENT_CODE } from '@element-plus/utils/aria'\nimport {\n  ROVING_FOCUS_COLLECTION_INJECTION_KEY,\n  ElCollectionItem as ElRovingFocusCollectionItem,\n} from './roving-focus-group'\nimport {\n  ROVING_FOCUS_GROUP_INJECTION_KEY,\n  ROVING_FOCUS_GROUP_ITEM_INJECTION_KEY,\n} from './tokens'\nimport { getFocusIntent, reorderArray, focusFirst } from './utils'\n\nexport default defineComponent({\n  components: {\n    ElRovingFocusCollectionItem,\n  },\n  props: {\n    focusable: {\n      type: Boolean,\n      default: true,\n    },\n    active: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  emits: ['mousedown', 'focus', 'keydown'],\n  setup(props, { emit }) {\n    const { currentTabbedId, loop, onItemFocus, onItemShiftTab } = inject(\n      ROVING_FOCUS_GROUP_INJECTION_KEY,\n      undefined\n    )!\n\n    const { getItems } = inject(\n      ROVING_FOCUS_COLLECTION_INJECTION_KEY,\n      undefined\n    )!\n\n    const id = useId()\n    const rovingFocusGroupItemRef = ref<HTMLElement | null>(null)\n\n    const handleMousedown = composeEventHandlers(\n      (e: Event) => {\n        emit('mousedown', e)\n      },\n      (e) => {\n        if (!props.focusable) {\n          e.preventDefault()\n        } else {\n          onItemFocus(unref(id))\n        }\n      }\n    )\n\n    const handleFocus = composeEventHandlers(\n      (e: Event) => {\n        emit('focus', e)\n      },\n      () => {\n        onItemFocus(unref(id))\n      }\n    )\n\n    const handleKeydown = composeEventHandlers(\n      (e: Event) => {\n        emit('keydown', e)\n      },\n      (e) => {\n        const { key, shiftKey, target, currentTarget } = e as KeyboardEvent\n        if (key === EVENT_CODE.tab && shiftKey) {\n          onItemShiftTab()\n          return\n        }\n        if (target !== currentTarget) return\n        const focusIntent = getFocusIntent(e as KeyboardEvent)\n\n        if (focusIntent) {\n          e.preventDefault()\n          const items = getItems<typeof props>().filter(\n            (item) => item.focusable\n          )\n\n          let elements = items.map((item) => item.ref!)\n\n          switch (focusIntent) {\n            case 'last': {\n              elements.reverse()\n              break\n            }\n            case 'prev':\n            case 'next': {\n              if (focusIntent === 'prev') {\n                elements.reverse()\n              }\n              const currentIdx = elements.indexOf(currentTarget as HTMLElement)\n              elements = loop.value\n                ? reorderArray(elements, currentIdx + 1)\n                : elements.slice(currentIdx + 1)\n              break\n            }\n            default: {\n              break\n            }\n          }\n\n          nextTick(() => {\n            focusFirst(elements)\n          })\n        }\n      }\n    )\n\n    const isCurrentTab = computed(() => currentTabbedId.value === unref(id))\n\n    provide(ROVING_FOCUS_GROUP_ITEM_INJECTION_KEY, {\n      rovingFocusGroupItemRef,\n      tabIndex: computed(() => (unref(isCurrentTab) ? 0 : -1)),\n      handleMousedown,\n      handleFocus,\n      handleKeydown,\n    })\n\n    return {\n      id,\n      handleKeydown,\n      handleFocus,\n      handleMousedown,\n    }\n  },\n})\n</script>\n"],"names":["defineComponent","ElRovingFocusCollectionItem","inject","useId","ref","composeEventHandlers","unref","getFocusIntent","focusFirst","computed"],"mappings":";;;;;;;;;;;;;AA+BA,aAAeA,mBAAe,CAAC;;AAE/B,iCAAIC,iCAA2B;GAC5B;OACI,EAAE;;MAEH;MACA,OAAO,EAAE;;UAEL,EAAE;;MAEN;;;;EAIJ;IACE,MAAM,EAAE,eAAe,EAAE,IAAI,EAAE;IAC/B,MAAM,EAAE,QAAQ,EAAE,GAAGC;IACrB,MAAM,EAAE,GAAGC,WAAK,EAAE,CAAC;UACb,uBAAuB,GAAGC;UAC1B;;;MAGJ,IAAI,MAAM,CAAC,SAAS,EAAE;QACpB,CAAC,CAAC,cAAc,EAAE,CAAC;OACpB,MAAM;;;KAGR,CAAC,CAAC;IACH,MAAM,WAAW,GAAGC,wBAAoB,CAAC,CAAC,CAAC,KAAK;;KAE/C,EAAE,MAAM;MACP,WAAW,CAACC;;;MAGZ,IAAI,CAAC;QACH,CAAC,KAAK;YACF,EAAE,GAAG,EAAE,QAAQ;UACjB,GAAG;sBACS,EAAE,CAAC;QACjB;;;;MAIF,MAAM,cAAcC,oBAAc,CAAC,CAAC,CAAC,CAAC;MACtC,IAAI;QACF,CAAC,CAAC;;YAEE;QACJ,QAAQ,WAAW;;;;WAIhB;UACD,KAAK;UACL,KAAK,MAAM;;;;YAIT,MAAM,UAAU,GAAG,QAAQ,CAAC,QAAQ;YACpC,QAAQ,GAAG;YACX;;mBAEO;YACP,MAAM;;SAET;oBACO,CAAC,MAAM;UACbC,gBAAU,SAAS,CAAC,CAAC;;;;UAIrB,eAAeC,YAAQ,CAAC,MAAM;;6BAEX;cACf,eAAW;qBACJ;iBACJ;;;;;mBAKE;;qBAEE;;;;;;;"}