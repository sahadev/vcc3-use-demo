{"version":3,"file":"bar.vue_vue_type_script_lang.js","sources":["../../../../../../packages/components/scrollbar/src/bar.vue"],"sourcesContent":["<template>\n  <transition name=\"el-scrollbar-fade\">\n    <div\n      v-show=\"always || visible\"\n      ref=\"instance\"\n      :class=\"['el-scrollbar__bar', 'is-' + bar.key]\"\n      @mousedown=\"clickTrackHandler\"\n    >\n      <div\n        ref=\"thumb\"\n        class=\"el-scrollbar__thumb\"\n        :style=\"thumbStyle\"\n        @mousedown=\"clickThumbHandler\"\n      ></div>\n    </div>\n  </transition>\n</template>\n\n<script lang=\"ts\">\nimport {\n  computed,\n  defineComponent,\n  inject,\n  onBeforeUnmount,\n  ref,\n  toRef,\n} from 'vue'\nimport { useEventListener } from '@vueuse/core'\nimport { scrollbarContextKey } from '@element-plus/tokens'\nimport { throwError } from '@element-plus/utils/error'\nimport { BAR_MAP, renderThumbStyle } from './util'\n\nimport { barProps } from './bar'\n\nconst COMPONENT_NAME = 'Bar'\nexport default defineComponent({\n  name: COMPONENT_NAME,\n  props: barProps,\n\n  setup(props) {\n    const scrollbar = inject(scrollbarContextKey)\n    if (!scrollbar)\n      throwError(COMPONENT_NAME, 'can not inject scrollbar context')\n\n    const instance = ref<HTMLDivElement>()\n    const thumb = ref<HTMLDivElement>()\n\n    const barStore = ref({})\n    const visible = ref(false)\n\n    let cursorDown = false\n    let cursorLeave = false\n    let onselectstartStore:\n      | ((this: GlobalEventHandlers, ev: Event) => any)\n      | null = null\n\n    const bar = computed(\n      () => BAR_MAP[props.vertical ? 'vertical' : 'horizontal']\n    )\n\n    const thumbStyle = computed(() =>\n      renderThumbStyle({\n        size: props.size,\n        move: props.move,\n        bar: bar.value,\n      })\n    )\n\n    const offsetRatio = computed(\n      () =>\n        // offsetRatioX = original width of thumb / current width of thumb / ratioX\n        // offsetRatioY = original height of thumb / current height of thumb / ratioY\n        // instance height = wrap height - GAP\n        instance.value![bar.value.offset] ** 2 /\n        scrollbar.wrapElement![bar.value.scrollSize] /\n        props.ratio /\n        thumb.value![bar.value.offset]\n    )\n\n    const clickThumbHandler = (e: MouseEvent) => {\n      // prevent click event of middle and right button\n      e.stopPropagation()\n      if (e.ctrlKey || [1, 2].includes(e.button)) return\n\n      window.getSelection()?.removeAllRanges()\n      startDrag(e)\n\n      const el = e.currentTarget as HTMLDivElement\n      if (!el) return\n      barStore.value[bar.value.axis] =\n        el[bar.value.offset] -\n        (e[bar.value.client] - el.getBoundingClientRect()[bar.value.direction])\n    }\n\n    const clickTrackHandler = (e: MouseEvent) => {\n      if (!thumb.value || !instance.value || !scrollbar.wrapElement) return\n\n      const offset = Math.abs(\n        (e.target as HTMLElement).getBoundingClientRect()[bar.value.direction] -\n          e[bar.value.client]\n      )\n      const thumbHalf = thumb.value[bar.value.offset] / 2\n      const thumbPositionPercentage =\n        ((offset - thumbHalf) * 100 * offsetRatio.value) /\n        instance.value[bar.value.offset]\n\n      scrollbar.wrapElement[bar.value.scroll] =\n        (thumbPositionPercentage *\n          scrollbar.wrapElement[bar.value.scrollSize]) /\n        100\n    }\n\n    const startDrag = (e: MouseEvent) => {\n      e.stopImmediatePropagation()\n      cursorDown = true\n      document.addEventListener('mousemove', mouseMoveDocumentHandler)\n      document.addEventListener('mouseup', mouseUpDocumentHandler)\n      onselectstartStore = document.onselectstart\n      document.onselectstart = () => false\n    }\n\n    const mouseMoveDocumentHandler = (e: MouseEvent) => {\n      if (!instance.value || !thumb.value) return\n      if (cursorDown === false) return\n\n      const prevPage = barStore.value[bar.value.axis]\n      if (!prevPage) return\n\n      const offset =\n        (instance.value.getBoundingClientRect()[bar.value.direction] -\n          e[bar.value.client]) *\n        -1\n      const thumbClickPosition = thumb.value[bar.value.offset] - prevPage\n      const thumbPositionPercentage =\n        ((offset - thumbClickPosition) * 100 * offsetRatio.value) /\n        instance.value[bar.value.offset]\n      scrollbar.wrapElement[bar.value.scroll] =\n        (thumbPositionPercentage *\n          scrollbar.wrapElement[bar.value.scrollSize]) /\n        100\n    }\n\n    const mouseUpDocumentHandler = () => {\n      cursorDown = false\n      barStore.value[bar.value.axis] = 0\n      document.removeEventListener('mousemove', mouseMoveDocumentHandler)\n      document.removeEventListener('mouseup', mouseUpDocumentHandler)\n      document.onselectstart = onselectstartStore\n      if (cursorLeave) visible.value = false\n    }\n\n    const mouseMoveScrollbarHandler = () => {\n      cursorLeave = false\n      visible.value = !!props.size\n    }\n\n    const mouseLeaveScrollbarHandler = () => {\n      cursorLeave = true\n      visible.value = cursorDown\n    }\n\n    onBeforeUnmount(() =>\n      document.removeEventListener('mouseup', mouseUpDocumentHandler)\n    )\n\n    useEventListener(\n      toRef(scrollbar, 'scrollbarElement'),\n      'mousemove',\n      mouseMoveScrollbarHandler\n    )\n    useEventListener(\n      toRef(scrollbar, 'scrollbarElement'),\n      'mouseleave',\n      mouseLeaveScrollbarHandler\n    )\n\n    return {\n      instance,\n      thumb,\n      bar,\n      thumbStyle,\n      visible,\n      clickTrackHandler,\n      clickThumbHandler,\n    }\n  },\n})\n</script>\n"],"names":["defineComponent","barProps","scrollbar","inject","ref","computed","useEventListener","toRef"],"mappings":";;;;;;;;;;;;;AAgCA,aAAeA,mBAAe,CAAC;;AAE/B,EAAE,KAAK,EAAEC,YAAQ;AACjB,EAAE,KAAK,CAAC,KAAK,EAAE;IACX,MAAMC,WAAS,GAAGC;IAClB,KAAKD;;IAEL,MAAM;IACN,MAAM,KAAK,GAAGE,SAAK,CAAC;IACpB,MAAM,QAAQ;UACR,OAAO,GAAGA,OAAG,CAAC,KAAK,CAAC,CAAC;;IAE3B,IAAI,WAAW,GAAG,KAAK,CAAC;IACxB,IAAI,kBAAkB,GAAG,IAAI,CAAC;;IAE9B,MAAM,aAAaC;MACjB,IAAI,EAAE,MAAM,IAAI;;MAEhB,GAAG,EAAE,GAAG,CAAC;KACV,CAAC,EAAE;IACJ,MAAM,WAAW,GAAGA;UACd,iBAAiB,GAAG,CAAC,CAAC,KAAK;MAC/B,IAAI,GAAG;;MAEP,IAAI,CAAC,CAAC,OAAO,IAAI,CAAC;eACT;;;MAGT,MAAM,EAAE,GAAG,CAAC,CAAC,aAAa,CAAC;MAC3B,IAAI,CAAC,EAAE;QACL,OAAO;cACD,CAAC,KAAK,CAAC,GAAG;;;;;MAKlB,MAAM,MAAM,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC;MAC1B;YACM,uBAAuB,GAAG,CAAC,MAAM,GAAG,SAAS,IAAI,GAAG,GAAG,WAAW,CAAC;iBAChE,CAAC,WAAW,CAAC,GAAG,CAAC,KAAK,CAAC,OAAO,GAAG,uBAAuB,GAAGH,WAAS,CAAC;;UAE1E,SAAS,GAAG,CAAC,CAAC,KAAK;QACrB,wBAAwB,EAAE,CAAC;gBACnB;cACF,CAAC,gBAAgB,CAAC;;;MAG1B,QAAQ,CAAC,aAAa,GAAG,MAAM,KAAK,CAAC;MACrC;UACI;MACJ,IAAI,CAAC,SAAS,KAAK,IAAI,CAAC,KAAK,CAAC,KAAK;;MAEnC,IAAI,UAAU,KAAK,KAAK;QACtB,OAAO;;MAET,IAAI,SAAS;eACJ;MACT,MAAM,MAAM,GAAG,CAAC,QAAQ,CAAC,MAAM;YACzB;YACA,uBAAuB,GAAG,CAAC,MAAM,GAAG,kBAAkB,IAAI,GAAG,GAAG;;;IAGxE,MAAM,sBAAsB,GAAG,MAAM;MACnC,UAAU,GAAG,KAAK;;MAElB,QAAQ,CAAC;cACD,CAAC,mBAAmB,CAAC,SAAS,EAAE,sBAAsB,CAAC,CAAC;cACxD,CAAC,aAAa;MACtB;QACE,OAAO,CAAC,QAAQ,KAAK,CAAC;MACxB;UACI,4BAA4B,MAAM;iBAC3B,GAAG,KAAK,CAAC;;MAEpB;UACI;iBACO,GAAG,IAAI,CAAC;;;;IAIrBI,qBAAgB,UAAM,CAACJ,WAAS,EAAE;yBAClB,CAACK,SAAK,CAACL;WAChB;MACL,QAAQ;MACR,KAAK;MACL,GAAG;MACH,UAAU;;;MAGV,iBAAiB;MACjB;;;;;;"}