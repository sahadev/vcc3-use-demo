{"version":3,"file":"index.js","sources":["../../../../../../../packages/components/table/src/table-header/index.ts"],"sourcesContent":["import {\n  defineComponent,\n  getCurrentInstance,\n  computed,\n  onMounted,\n  nextTick,\n  ref,\n  h,\n} from 'vue'\nimport ElCheckbox from '@element-plus/components/checkbox'\nimport FilterPanel from '../filter-panel.vue'\nimport useLayoutObserver from '../layout-observer'\nimport { hColgroup } from '../h-helper'\nimport useEvent from './event-helper'\nimport useStyle from './style.helper'\nimport useUtils from './utils-helper'\n\nimport type { ComponentInternalInstance, Ref, PropType } from 'vue'\nimport type { DefaultRow, Sort, Table } from '../table/defaults'\nimport type { Store } from '../store'\nexport interface TableHeader extends ComponentInternalInstance {\n  state: {\n    onColumnsChange\n    onScrollableChange\n  }\n  filterPanels: Ref<unknown>\n}\nexport interface TableHeaderProps<T> {\n  fixed: string\n  store: Store<T>\n  border: boolean\n  defaultSort: Sort\n}\n\nexport default defineComponent({\n  name: 'ElTableHeader',\n  components: {\n    ElCheckbox,\n  },\n  props: {\n    fixed: {\n      type: String,\n      default: '',\n    },\n    store: {\n      required: true,\n      type: Object as PropType<TableHeaderProps<DefaultRow>['store']>,\n    },\n    border: Boolean,\n    defaultSort: {\n      type: Object as PropType<TableHeaderProps<DefaultRow>['defaultSort']>,\n      default: () => {\n        return {\n          prop: '',\n          order: '',\n        }\n      },\n    },\n  },\n  setup(props, { emit }) {\n    const instance = getCurrentInstance() as TableHeader\n    const parent = instance.parent as Table<unknown>\n    const storeData = parent.store.states\n    const filterPanels = ref({})\n    const { tableLayout, onColumnsChange, onScrollableChange } =\n      useLayoutObserver(parent)\n    const hasGutter = computed(() => {\n      return (\n        !props.fixed &&\n        tableLayout.gutterWidth > 0 &&\n        tableLayout.bodyScrollHeight.value > tableLayout.bodyHeight.value\n      )\n    })\n    const gutterWidth = computed(() => {\n      return tableLayout.gutterWidth\n    })\n    onMounted(() => {\n      nextTick(() => {\n        const { prop, order } = props.defaultSort\n        const init = true\n        parent.store.commit('sort', { prop, order, init })\n      })\n    })\n    const {\n      handleHeaderClick,\n      handleHeaderContextMenu,\n      handleMouseDown,\n      handleMouseMove,\n      handleMouseOut,\n      handleSortClick,\n      handleFilterClick,\n    } = useEvent(props as TableHeaderProps<unknown>, emit)\n    const {\n      getHeaderRowStyle,\n      getHeaderRowClass,\n      getHeaderCellStyle,\n      getHeaderCellClass,\n    } = useStyle(props as TableHeaderProps<unknown>)\n    const { isGroup, toggleAllSelection, columnRows } = useUtils(\n      props as TableHeaderProps<unknown>\n    )\n\n    instance.state = {\n      onColumnsChange,\n      onScrollableChange,\n    }\n    // eslint-disable-next-line\n    instance.filterPanels = filterPanels\n\n    return {\n      columns: storeData.columns,\n      filterPanels,\n      hasGutter,\n      gutterWidth,\n      onColumnsChange,\n      onScrollableChange,\n      columnRows,\n      getHeaderRowClass,\n      getHeaderRowStyle,\n      getHeaderCellClass,\n      getHeaderCellStyle,\n      handleHeaderClick,\n      handleHeaderContextMenu,\n      handleMouseDown,\n      handleMouseMove,\n      handleMouseOut,\n      handleSortClick,\n      handleFilterClick,\n      isGroup,\n      toggleAllSelection,\n    }\n  },\n  render() {\n    const {\n      columns,\n      isGroup,\n      hasGutter,\n      columnRows,\n      gutterWidth,\n      getHeaderCellStyle,\n      getHeaderCellClass,\n      getHeaderRowClass,\n      getHeaderRowStyle,\n      handleHeaderClick,\n      handleHeaderContextMenu,\n      handleMouseDown,\n      handleMouseMove,\n      handleSortClick,\n      handleMouseOut,\n      store,\n      $parent,\n    } = this\n    let rowSpan = 1\n    return h(\n      'table',\n      {\n        border: '0',\n        cellpadding: '0',\n        cellspacing: '0',\n        class: 'el-table__header',\n      },\n      [\n        hColgroup(columns, hasGutter),\n        h(\n          'thead',\n          {\n            class: { 'is-group': isGroup, 'has-gutter': hasGutter },\n          },\n          columnRows.map((subColumns, rowIndex) =>\n            h(\n              'tr',\n              {\n                class: getHeaderRowClass(rowIndex),\n                key: rowIndex,\n                style: getHeaderRowStyle(rowIndex),\n              },\n              subColumns\n                .map((column, cellIndex) => {\n                  if (column.rowSpan > rowSpan) {\n                    rowSpan = column.rowSpan\n                  }\n                  return h(\n                    'th',\n                    {\n                      class: getHeaderCellClass(\n                        rowIndex,\n                        cellIndex,\n                        subColumns,\n                        column\n                      ),\n                      colspan: column.colSpan,\n                      key: `${column.id}-thead`,\n                      rowSpan: column.rowSpan,\n                      style: getHeaderCellStyle(\n                        rowIndex,\n                        cellIndex,\n                        subColumns,\n                        column,\n                        hasGutter\n                      ),\n                      onClick: ($event) => handleHeaderClick($event, column),\n                      onContextmenu: ($event) =>\n                        handleHeaderContextMenu($event, column),\n                      onMousedown: ($event) => handleMouseDown($event, column),\n                      onMousemove: ($event) => handleMouseMove($event, column),\n                      onMouseout: handleMouseOut,\n                    },\n                    [\n                      h(\n                        'div',\n                        {\n                          class: [\n                            'cell',\n                            column.filteredValue &&\n                            column.filteredValue.length > 0\n                              ? 'highlight'\n                              : '',\n                            column.labelClassName,\n                          ],\n                        },\n                        [\n                          column.renderHeader\n                            ? column.renderHeader({\n                                column,\n                                $index: cellIndex,\n                                store,\n                                _self: $parent,\n                              })\n                            : column.label,\n                          column.sortable &&\n                            h(\n                              'span',\n                              {\n                                onClick: ($event) =>\n                                  handleSortClick($event, column),\n                                class: 'caret-wrapper',\n                              },\n                              [\n                                h('i', {\n                                  onClick: ($event) =>\n                                    handleSortClick(\n                                      $event,\n                                      column,\n                                      'ascending'\n                                    ),\n                                  class: 'sort-caret ascending',\n                                }),\n                                h('i', {\n                                  onClick: ($event) =>\n                                    handleSortClick(\n                                      $event,\n                                      column,\n                                      'descending'\n                                    ),\n                                  class: 'sort-caret descending',\n                                }),\n                              ]\n                            ),\n                          column.filterable &&\n                            h(FilterPanel, {\n                              store: $parent.store,\n                              placement:\n                                column.filterPlacement || 'bottom-start',\n                              column,\n                              upDataColumn: (key, value) => {\n                                column[key] = value\n                              },\n                            }),\n                        ]\n                      ),\n                    ]\n                  )\n                })\n                .concat(\n                  hasGutter && rowIndex === 0\n                    ? [\n                        h(\n                          'th',\n                          {\n                            class: 'el-table__fixed-right-patch el-table__cell',\n                            key: `el-table--scrollbar`,\n                            rowSpan,\n                            style: {\n                              width: `${gutterWidth}px`,\n                            },\n                          },\n                          []\n                        ),\n                      ]\n                    : []\n                )\n            )\n          )\n        ),\n      ]\n    )\n  },\n})\n"],"names":["defineComponent","ElCheckbox","getCurrentInstance","ref","useLayoutObserver","computed","onMounted","nextTick","useEvent","useStyle","useUtils","h","hColgroup","FilterPanel"],"mappings":"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"}