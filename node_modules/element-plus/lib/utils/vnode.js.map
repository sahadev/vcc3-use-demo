{"version":3,"file":"vnode.js","sources":["../../../../packages/utils/vnode.ts"],"sourcesContent":["import {\n  Fragment,\n  Text,\n  Comment,\n  createBlock,\n  openBlock,\n  createCommentVNode,\n  isVNode,\n  camelize,\n} from 'vue'\n\nimport { hasOwn } from '@vue/shared'\nimport { debugWarn } from './error'\nimport type { VNode, VNodeTypes, VNodeChild } from 'vue'\n\ntype Children = VNodeTypes[] | VNodeTypes\n\nconst TEMPLATE = 'template'\n\nexport const SCOPE = 'VNode'\n\nexport enum PatchFlags {\n  TEXT = 1,\n  CLASS = 2,\n  STYLE = 4,\n  PROPS = 8,\n  FULL_PROPS = 16,\n  HYDRATE_EVENTS = 32,\n  STABLE_FRAGMENT = 64,\n  KEYED_FRAGMENT = 128,\n  UNKEYED_FRAGMENT = 256,\n  NEED_PATCH = 512,\n  DYNAMIC_SLOTS = 1024,\n  HOISTED = -1,\n  BAIL = -2,\n}\n\nexport const isFragment = (node: unknown): node is VNode =>\n  isVNode(node) && node.type === Fragment\n\nexport const isText = (node: VNodeChild) => (node as VNode).type === Text\n\nexport const isComment = (node: VNodeChild) => (node as VNode).type === Comment\n\nexport const isTemplate = (node: VNodeChild) =>\n  (node as VNode).type === TEMPLATE\n\n/**\n * get a valid child node (not fragment nor comment)\n * @param node {VNode} node to be searched\n * @param depth {number} depth to be searched\n */\nfunction getChildren(node: VNode, depth: number): undefined | VNode {\n  if (isComment(node)) return\n  if (isFragment(node) || isTemplate(node)) {\n    return depth > 0\n      ? getFirstValidNode(node.children as VNodeChild, depth - 1)\n      : undefined\n  }\n  return node\n}\n\n/**\n * determine if the element is a valid element type rather than fragments and comment e.g. <template> v-if\n * @param node {VNode} node to be tested\n */\nexport const isValidElementNode = (node: unknown): node is VNode =>\n  isVNode(node) && !isFragment(node) && !isComment(node)\n\nexport const getFirstValidNode = (\n  nodes: VNodeChild,\n  maxDepth = 3\n): ReturnType<typeof getChildren> => {\n  if (Array.isArray(nodes)) {\n    return getChildren(nodes[0] as VNode, maxDepth)\n  } else {\n    return getChildren(nodes as VNode, maxDepth)\n  }\n}\n\nexport function renderIf(\n  condition: boolean,\n  node: VNodeTypes,\n  props: any,\n  children?: Children,\n  patchFlag?: number,\n  patchProps?: string[]\n) {\n  return condition\n    ? renderBlock(node, props, children, patchFlag, patchProps)\n    : createCommentVNode('v-if', true)\n}\n\nexport function renderBlock(\n  node: VNodeTypes,\n  props: any,\n  children?: Children,\n  patchFlag?: number,\n  patchProps?: string[]\n) {\n  return openBlock(), createBlock(node, props, children, patchFlag, patchProps)\n}\n\n/**\n * todo\n * get normalized props from VNode\n * @param node\n */\nexport const getNormalizedProps = (node: VNode) => {\n  if (!isVNode(node)) {\n    debugWarn(SCOPE, 'value must be a VNode')\n    return\n  }\n\n  const raw = node.props || {}\n  const type = (node.type as any).props || {}\n  const props = {} as any\n\n  Object.keys(type).forEach((key) => {\n    if (hasOwn(type[key], 'default')) {\n      props[key] = type[key].default\n    }\n  })\n\n  Object.keys(raw).forEach((key) => {\n    props[camelize(key)] = raw[key]\n  })\n\n  return props\n}\n"],"names":["isVNode","Fragment","Text","Comment","createCommentVNode","openBlock","createBlock","debugWarn","hasOwn","camelize"],"mappings":"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"}